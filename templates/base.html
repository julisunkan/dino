<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a1a1a">
    <title>{% block title %}Extinct Animals{% endblock %}</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    
    {% block extra_head %}{% endblock %}
</head>
<body class="mobile-app">
    <!-- Mobile Status Bar Spacer -->
    <div class="status-bar-spacer"></div>
    
    <!-- Mobile Header -->
    <header class="mobile-header">
        <div class="header-content">
            {% block header_left %}
            <button class="header-btn" onclick="history.back()" style="{% if request.endpoint == 'index' %}visibility: hidden;{% endif %}">
                <i class="fas fa-arrow-left"></i>
            </button>
            {% endblock %}
            
            <h1 class="header-title">
                {% block header_title %}Extinct Animals{% endblock %}
            </h1>
            
            {% block header_right %}
            <button class="header-btn" onclick="showMenu()">
                <i class="fas fa-ellipsis-vertical"></i>
            </button>
            {% endblock %}
        </div>
    </header>

    <!-- Main Content -->
    <main class="mobile-main">
        {% block content %}{% endblock %}
    </main>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav" style="{% if request.endpoint == 'color_animal' %}display: none;{% endif %}">
        <a href="{{ url_for('index') }}" class="nav-item {% if request.endpoint == 'index' %}active{% endif %}">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </a>
        <a href="{{ url_for('random_animal') }}" class="nav-item">
            <i class="fas fa-shuffle"></i>
            <span>Random</span>
        </a>
        <div class="nav-item" onclick="showProgress()">
            <i class="fas fa-chart-line"></i>
            <span>Progress</span>
        </div>
        <div class="nav-item" onclick="showMenu()">
            <i class="fas fa-bars"></i>
            <span>Menu</span>
        </div>
    </nav>

    <!-- Mobile Menu Overlay -->
    <div class="mobile-overlay" id="mobileMenu" onclick="hideMenu()">
        <div class="mobile-menu" onclick="event.stopPropagation()">
            <div class="menu-header">
                <h3>Menu</h3>
                <button class="close-btn" onclick="hideMenu()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="menu-items">
                <a href="{{ url_for('index') }}" class="menu-item">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </a>
                <a href="{{ url_for('random_animal') }}" class="menu-item">
                    <i class="fas fa-shuffle"></i>
                    <span>Random Animal</span>
                </a>
                <div class="menu-item" onclick="showProgress()">
                    <i class="fas fa-chart-line"></i>
                    <span>Progress</span>
                </div>
                <div class="menu-item" onclick="shareApp()">
                    <i class="fas fa-share"></i>
                    <span>Share App</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Progress Modal -->
    <div class="mobile-overlay" id="progressModal" onclick="hideProgress()">
        <div class="progress-modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3>Your Progress</h3>
                <button class="close-btn" onclick="hideProgress()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-content">
                <div class="progress-circle">
                    <div class="progress-value" id="progressValue">0%</div>
                </div>
                <p class="progress-text" id="progressText">Keep coloring to discover more animals!</p>
                <div class="progress-stats">
                    <div class="stat">
                        <span class="stat-number" id="coloredCount">0</span>
                        <span class="stat-label">Colored</span>
                    </div>
                    <div class="stat">
                        <span class="stat-number">20</span>
                        <span class="stat-label">Total</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Mobile App JS -->
    <script>
        function showMenu() {
            document.getElementById('mobileMenu').classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        function hideMenu() {
            document.getElementById('mobileMenu').classList.remove('active');
            document.body.style.overflow = '';
        }
        
        function showProgress() {
            updateProgressModal();
            document.getElementById('progressModal').classList.add('active');
            document.body.style.overflow = 'hidden';
            hideMenu();
        }
        
        function hideProgress() {
            document.getElementById('progressModal').classList.remove('active');
            document.body.style.overflow = '';
        }
        
        function updateProgressModal() {
            const coloredAnimals = JSON.parse(localStorage.getItem('coloredAnimals') || '[]');
            const total = 20;
            const colored = coloredAnimals.length;
            const percentage = Math.round((colored / total) * 100);
            
            document.getElementById('progressValue').textContent = percentage + '%';
            document.getElementById('coloredCount').textContent = colored;
            
            let progressText = 'Keep coloring to discover more animals!';
            if (colored === 0) {
                progressText = 'Start your coloring journey!';
            } else if (colored < 5) {
                progressText = 'Great start! Keep going!';
            } else if (colored < 10) {
                progressText = 'You\'re doing amazing!';
            } else if (colored < 15) {
                progressText = 'Almost halfway there!';
            } else if (colored < 20) {
                progressText = 'So close to completing all animals!';
            } else {
                progressText = 'Congratulations! All animals colored!';
            }
            
            document.getElementById('progressText').textContent = progressText;
        }
        
        function shareApp() {
            if (navigator.share) {
                navigator.share({
                    title: 'Extinct Animals Coloring Book',
                    text: 'Check out this amazing extinct animals coloring app!',
                    url: window.location.href
                });
            } else {
                // Fallback for browsers that don't support Web Share API
                navigator.clipboard.writeText(window.location.href).then(() => {
                    alert('App link copied to clipboard!');
                });
            }
            hideMenu();
        }
        
        // Prevent pull-to-refresh
        document.addEventListener('touchstart', function(e) {
            if (e.touches.length > 1) {
                e.preventDefault();
            }
        }, { passive: false });
        
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(e) {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                e.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
    
    {% block scripts %}{% endblock %}
</body>
</html>
