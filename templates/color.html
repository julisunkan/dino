{% extends "base.html" %}

{% block title %}{{ animal.name }}{% endblock %}

{% block header_title %}{{ animal.name }}{% endblock %}

{% block header_right %}
<button class="header-btn" onclick="shareColoring()">
    <i class="fas fa-share"></i>
</button>
{% endblock %}

{% block content %}
<!-- Animal Info Header -->
<div class="coloring-header">
    <p class="animal-subtitle">{{ animal.category.title() }} â€¢ {{ animal.location }}</p>
</div>

<!-- Coloring Interface -->
<div class="coloring-container">
    <!-- SVG Canvas -->
    <div class="svg-container" id="svgContainer">
        <!-- SVG will be loaded here -->
    </div>
    
    <!-- Color Palette -->
    <div class="color-palette-section">
        <h3 class="palette-title">Choose Colors</h3>
        <div class="color-palette" id="colorPalette">
            <div class="color-option active" data-color="#ff6b6b" style="background-color: #ff6b6b;"></div>
            <div class="color-option" data-color="#4ecdc4" style="background-color: #4ecdc4;"></div>
            <div class="color-option" data-color="#45b7d1" style="background-color: #45b7d1;"></div>
            <div class="color-option" data-color="#96ceb4" style="background-color: #96ceb4;"></div>
            <div class="color-option" data-color="#feca57" style="background-color: #feca57;"></div>
            <div class="color-option" data-color="#ff9ff3" style="background-color: #ff9ff3;"></div>
            <div class="color-option" data-color="#54a0ff" style="background-color: #54a0ff;"></div>
            <div class="color-option" data-color="#5f27cd" style="background-color: #5f27cd;"></div>
            <div class="color-option" data-color="#00d2d3" style="background-color: #00d2d3;"></div>
            <div class="color-option" data-color="#ff6348" style="background-color: #ff6348;"></div>
            <div class="color-option" data-color="#2ed573" style="background-color: #2ed573;"></div>
            <div class="color-option" data-color="#a4b0be" style="background-color: #a4b0be;"></div>
        </div>
    </div>
    
    <!-- Controls -->
    <div class="controls">
        <button class="control-btn" onclick="undoLastAction()">
            <i class="fas fa-undo"></i> Undo
        </button>
        <button class="control-btn" onclick="redoLastAction()">
            <i class="fas fa-redo"></i> Redo
        </button>
        <button class="control-btn" onclick="clearColoring()">
            <i class="fas fa-eraser"></i> Clear
        </button>
        <button class="control-btn primary" onclick="exportColoring()">
            <i class="fas fa-download"></i> Save
        </button>
    </div>
</div>

<!-- Animal Facts Section -->
<div class="color-palette-section">
    <h3 class="palette-title">About {{ animal.name }}</h3>
    <p style="color: #8E8E93; line-height: 1.6;">{{ animal.description }}</p>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 16px;">
        <div style="background: #2C2C2E; padding: 12px; border-radius: 12px;">
            <div style="color: #007AFF; font-size: 12px; text-transform: uppercase; margin-bottom: 4px;">Location</div>
            <div style="font-weight: 600;">{{ animal.location }}</div>
        </div>
        <div style="background: #2C2C2E; padding: 12px; border-radius: 12px;">
            <div style="color: #007AFF; font-size: 12px; text-transform: uppercase; margin-bottom: 4px;">Extinct</div>
            <div style="font-weight: 600;">{{ animal.extinction_date }}</div>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/coloring.js') }}"></script>
<script>
let coloringApp;

document.addEventListener('DOMContentLoaded', function() {
    // Initialize the coloring app
    coloringApp = new ColoringApp('{{ animal.id }}', '{{ animal.filename }}');
    coloringApp.init();
    
    // Setup color selection
    setupColorPalette();
});

function setupColorPalette() {
    const colorOptions = document.querySelectorAll('.color-option');
    
    colorOptions.forEach(option => {
        option.addEventListener('click', function() {
            // Remove active class from all options
            colorOptions.forEach(opt => opt.classList.remove('active'));
            
            // Add active class to clicked option
            this.classList.add('active');
            
            // Set the selected color in the coloring app
            if (coloringApp) {
                coloringApp.setSelectedColor(this.dataset.color);
            }
        });
    });
    
    // Set initial color
    const firstColor = document.querySelector('.color-option');
    if (firstColor && coloringApp) {
        coloringApp.setSelectedColor(firstColor.dataset.color);
    }
}

function undoLastAction() {
    if (coloringApp) {
        coloringApp.undo();
    }
}

function redoLastAction() {
    if (coloringApp) {
        coloringApp.redo();
    }
}

function clearColoring() {
    if (confirm('Clear all colors? This cannot be undone.')) {
        if (coloringApp) {
            coloringApp.clearAll();
        }
    }
}

function exportColoring() {
    if (coloringApp) {
        coloringApp.exportToPNG();
    }
}

function shareColoring() {
    if (navigator.share) {
        navigator.share({
            title: 'Look at my {{ animal.name }} coloring!',
            text: 'Check out how I colored this extinct {{ animal.name }}!',
            url: window.location.href
        });
    } else {
        // Fallback - copy link
        navigator.clipboard.writeText(window.location.href).then(() => {
            alert('Link copied to clipboard!');
        });
    }
}
</script>
{% endblock %}
